tinymce.PluginManager.add("lists",function(e){function n(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function t(e){return e.parentNode.firstChild==e}function r(e){return e.parentNode.lastChild==e}function i(n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]}function a(e){return e&&"SPAN"===e.nodeName&&"bookmark"===e.getAttribute("data-mce-type")}var o=this;e.on("init",function(){function d(e){function n(n){var r,i,a;i=e[n?"startContainer":"endContainer"],a=e[n?"startOffset":"endOffset"],1==i.nodeType&&(r=L.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(a=Math.min(a,i.childNodes.length-1),n?i.insertBefore(r,i.childNodes[a]):L.insertAfter(r,i.childNodes[a])):i.appendChild(r),i=r,a=0),t[n?"startContainer":"endContainer"]=i,t[n?"startOffset":"endOffset"]=a}var t={};return n(!0),e.collapsed||n(),t}function f(e){function n(n){function t(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n==e)return t;(1!=n.nodeType||"bookmark"!=n.getAttribute("data-mce-type"))&&t++,n=n.nextSibling}return-1}var r,i,a;r=a=e[n?"startContainer":"endContainer"],i=e[n?"startOffset":"endOffset"],r&&(1==r.nodeType&&(i=t(r),r=r.parentNode,L.remove(a)),e[n?"startContainer":"endContainer"]=r,e[n?"startOffset":"endOffset"]=i)}n(!0),n();var t=L.createRng();t.setStart(e.startContainer,e.startOffset),e.endContainer&&t.setEnd(e.endContainer,e.endOffset),b.setRng(t)}function s(n,t){var r,i,a,o=L.createFragment(),d=e.schema.getBlockElements();if(e.settings.forced_root_block&&(t=t||e.settings.forced_root_block),t&&(i=L.create(t),o.appendChild(i)),n)for(;r=n.firstChild;){var f=r.nodeName;a||"SPAN"==f&&"bookmark"==r.getAttribute("data-mce-type")||(a=!0),d[f]?(o.appendChild(r),i=null):t?(i||(i=L.create(t),o.appendChild(i)),i.appendChild(r)):o.appendChild(r)}return e.settings.forced_root_block?a||tinymce.Env.ie&&!(tinymce.Env.ie>10)||i.appendChild(L.create("br",{"data-mce-bogus":"1"})):o.appendChild(L.create("br")),o}function l(){return tinymce.grep(b.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function c(e,n,t){var r,i,a=L.select('span[data-mce-type="bookmark"]',e);t=t||s(n),r=L.createRng(),r.setStartAfter(n),r.setEndAfter(e),i=r.extractContents(),L.isEmpty(i)||L.insertAfter(i,e),L.insertAfter(t,e),L.isEmpty(n.parentNode)&&(tinymce.each(a,function(e){n.parentNode.parentNode.insertBefore(e,n.parentNode)}),L.remove(n.parentNode)),L.remove(n)}function p(e){var t,r;if(t=e.nextSibling,t&&n(t)&&t.nodeName==e.nodeName){for(;r=t.firstChild;)e.appendChild(r);L.remove(t)}if(t=e.previousSibling,t&&n(t)&&t.nodeName==e.nodeName){for(;r=t.firstChild;)e.insertBefore(r,e.firstChild);L.remove(t)}}function u(e){tinymce.each(tinymce.grep(L.select("ol,ul",e)),function(e){var t,r=e.parentNode;"LI"==r.nodeName&&r.firstChild==e&&(t=r.previousSibling,t&&"LI"==t.nodeName&&(t.appendChild(e),L.isEmpty(r)&&L.remove(r))),n(r)&&(t=r.previousSibling,t&&"LI"==t.nodeName&&t.appendChild(e))})}function m(e){function i(e){L.isEmpty(e)&&L.remove(e)}var a,o=e.parentNode,d=o.parentNode;return t(e)&&r(e)?("LI"==d.nodeName?(L.insertAfter(e,d),i(d),L.remove(o)):n(d)?L.remove(o,!0):(d.insertBefore(s(e),o),L.remove(o)),!0):t(e)?("LI"==d.nodeName?(L.insertAfter(e,d),e.appendChild(o),i(d)):n(d)?d.insertBefore(e,o):(d.insertBefore(s(e),o),L.remove(e)),!0):r(e)?("LI"==d.nodeName?L.insertAfter(e,d):n(d)?L.insertAfter(e,o):(L.insertAfter(s(e),o),L.remove(e)),!0):("LI"==d.nodeName?(o=d,a=s(e,"LI")):a=n(d)?s(e,"LI"):s(e),c(o,e,a),u(o.parentNode),!0)}function h(e){function t(t,r){var i;if(n(t)){for(;i=e.lastChild.firstChild;)r.appendChild(i);L.remove(t)}}var r,i;return r=e.previousSibling,r&&n(r)?(r.appendChild(e),!0):r&&"LI"==r.nodeName&&n(r.lastChild)?(r.lastChild.appendChild(e),t(e.lastChild,r.lastChild),!0):(r=e.nextSibling,r&&n(r)?(r.insertBefore(e,r.firstChild),!0):r&&"LI"==r.nodeName&&n(e.lastChild)?!1:(r=e.previousSibling,r&&"LI"==r.nodeName?(i=L.create(e.parentNode.nodeName),r.appendChild(i),i.appendChild(e),t(e.lastChild,i),!0):!1))}function v(){var n=l();if(n.length){for(var t=d(b.getRng(!0)),r=0;r<n.length&&(h(n[r])||0!==r);r++);return f(t),e.nodeChanged(),!0}}function C(){var n=l();if(n.length){var t,r,i=d(b.getRng(!0)),a=e.getBody();for(t=n.length;t--;)for(var o=n[t].parentNode;o&&o!=a;){for(r=n.length;r--;)if(n[r]===o){n.splice(t,1);break}o=o.parentNode}for(t=0;t<n.length&&(m(n[t])||0!==t);t++);return f(i),e.nodeChanged(),!0}}function g(t){function r(){function n(e){var n,t;for(n=o[e?"startContainer":"endContainer"],t=o[e?"startOffset":"endOffset"],1==n.nodeType&&(n=n.childNodes[Math.min(t,n.childNodes.length-1)]||n);n.parentNode!=d;){if(i(n))return n;if(/^(TD|TH)$/.test(n.parentNode.nodeName))return n;n=n.parentNode}return n}for(var t,r=[],d=e.getBody(),f=n(!0),s=n(),l=[],c=f;c&&(l.push(c),c!=s);c=c.nextSibling);return tinymce.each(l,function(e){if(i(e))return r.push(e),t=null,void 0;if(L.isBlock(e)||"BR"==e.nodeName)return"BR"==e.nodeName&&L.remove(e),t=null,void 0;var n=e.nextSibling;return a(e)&&(i(n)||!n&&e.parentNode==d)?(t=null,void 0):(t||(t=L.create("p"),e.parentNode.insertBefore(t,e),r.push(t)),t.appendChild(e),void 0)}),r}var o=b.getRng(!0),s=d(o),l=r();tinymce.each(l,function(e){var r,i;i=e.previousSibling,i&&n(i)&&i.nodeName==t?(r=i,e=L.rename(e,"LI"),i.appendChild(e)):(r=L.create(t),e.parentNode.insertBefore(r,e),r.appendChild(e),e=L.rename(e,"LI")),p(r)}),f(s)}function N(){var t=d(b.getRng(!0)),r=e.getBody();tinymce.each(l(),function(e){var t,i;if(L.isEmpty(e))return m(e),void 0;for(t=e;t&&t!=r;t=t.parentNode)n(t)&&(i=t);c(i,e)}),f(t)}function y(e){var n=L.getParent(b.getStart(),"OL,UL");if(n)if(n.nodeName==e)N(e);else{var t=d(b.getRng(!0));p(L.rename(n,e)),f(t)}else g(e)}var L=e.dom,b=e.selection;o.backspaceDelete=function(e){function t(e,n){var t=e.startContainer,r=e.startOffset;if(3==t.nodeType&&(n?r<t.data.length:r>0))return t;for(var i=new tinymce.dom.TreeWalker(e.startContainer);t=i[n?"next":"prev"]();)if(3==t.nodeType&&t.data.length>0)return t}function r(e,t){var r,i,a=e.parentNode;for(n(t.lastChild)&&(i=t.lastChild),r=t.lastChild,r&&"BR"==r.nodeName&&e.hasChildNodes()&&L.remove(r);r=e.firstChild;)t.appendChild(r);i&&t.appendChild(i),L.remove(e),L.isEmpty(a)&&L.remove(a)}if(b.isCollapsed()){var i=L.getParent(b.getStart(),"LI");if(i){var a=b.getRng(!0),o=L.getParent(t(a,e),"LI");if(o&&o!=i){var s=d(a);return e?r(o,i):r(i,o),f(s),!0}if(!o&&!e&&N(i.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return v()?void 0:!0}),e.addCommand("Outdent",function(){return C()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){y("UL")}),e.addCommand("InsertOrderedList",function(){y("OL")}),e.on("keydown",function(n){9==n.keyCode&&e.dom.getParent(e.selection.getStart(),"LI")&&(n.preventDefault(),n.shiftKey?C():v())})}),e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var n=this;e.on("nodechange",function(){var r=e.dom.getParent(e.selection.getNode(),"LI,UL,OL");n.disabled(r&&("LI"!=r.nodeName||t(r)))})}}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?o.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&o.backspaceDelete(!0)&&e.preventDefault()})});