tinymce.PluginManager.add("lists",function(e){var n=this;e.on("init",function(){function t(e){function n(n){var r,i,o;i=e[n?"startContainer":"endContainer"],o=e[n?"startOffset":"endOffset"],1==i.nodeType&&(r=g.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(o=Math.min(o,i.childNodes.length-1),i.insertBefore(r,i.childNodes[o])):i.appendChild(r),i=r,o=0),t[n?"startContainer":"endContainer"]=i,t[n?"startOffset":"endOffset"]=o}var t={};return n(!0),e.collapsed||n(),t}function r(n){function t(t){function r(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n==e)return t;(1!=n.nodeType||"bookmark"!=n.getAttribute("data-mce-type"))&&t++,n=n.nextSibling}return-1}var i,o,a;if(i=a=n[t?"startContainer":"endContainer"],o=n[t?"startOffset":"endOffset"],i){if(1==i.nodeType){if(i.parentNode==e.getBody()){var d,f=e.settings.forced_root_block;f?(d=g.create(f),(!tinymce.Env.ie||tinymce.Env.ie>10)&&d.appendChild(g.create("br",{"data-mce-bogus":"true"})),i.parentNode.insertBefore(d,i),i=d,o=0):(d=g.create("br"),i.parentNode.insertBefore(d,i),i=i.parentNode,o=r(d))}else t?(o=r(i),i=i.parentNode):(o=r(i),i=i.parentNode);g.remove(a)}n[t?"startContainer":"endContainer"]=i,n[t?"startOffset":"endOffset"]=o}}t(!0),t();var r=g.createRng();r.setStart(n.startContainer,n.startOffset),n.endContainer&&r.setEnd(n.endContainer,n.endOffset),y.setRng(r)}function i(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function o(e){return e.parentNode.firstChild==e}function a(e){return e.parentNode.lastChild==e}function d(n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]}function f(n,t){var r,i;if(e.settings.forced_root_block&&(t=t||e.settings.forced_root_block),i=t?g.create(t):g.createFragment(),n)for(;r=n.firstChild;)i.appendChild(r);return e.settings.forced_root_block||i.appendChild(g.create("br")),i.hasChildNodes()||tinymce.Env.ie&&!(tinymce.Env.ie>10)||(i.innerHTML='<br data-mce-bogus="1">'),i}function s(){return tinymce.grep(y.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function c(){return tinymce.grep(y.getSelectedBlocks(),d)}function l(e,n,t){var r,i,o=g.select('span[data-mce-type="bookmark"]',e);t=t||f(n),r=g.createRng(),r.setStartAfter(n),r.setEndAfter(e),i=r.extractContents(),g.isEmpty(i)||g.insertAfter(i,e),g.isEmpty(t)||g.insertAfter(t,e),g.isEmpty(n.parentNode)&&(tinymce.each(o,function(e){n.parentNode.parentNode.insertBefore(e,n.parentNode)}),g.remove(n.parentNode)),g.remove(n)}function p(e){var n,t;if(n=e.nextSibling,n&&i(n)&&n.nodeName==e.nodeName){for(;t=n.firstChild;)e.appendChild(t);g.remove(n)}if(n=e.previousSibling,n&&i(n)&&n.nodeName==e.nodeName){for(;t=n.firstChild;)e.insertBefore(t,e.firstChild);g.remove(n)}}function m(e){tinymce.each(tinymce.grep(g.select("ol,ul",e)),function(e){var n,t=e.parentNode;"LI"==t.nodeName&&t.firstChild==e&&(n=t.previousSibling,n&&"LI"==n.nodeName&&(n.appendChild(e),g.isEmpty(t)&&g.remove(t))),i(t)&&(n=t.previousSibling,n&&"LI"==n.nodeName&&n.appendChild(e))})}function u(){var e,n=t(y.getRng(!0));return tinymce.each(s(),function(n){var t,r;return t=n.previousSibling,t&&"UL"==t.nodeName?(t.appendChild(n),void 0):t&&"LI"==t.nodeName&&i(t.lastChild)?(t.lastChild.appendChild(n),void 0):(t=n.nextSibling,t&&"UL"==t.nodeName?(t.insertBefore(n,t.firstChild),void 0):(t&&"LI"==t.nodeName&&i(n.lastChild)||(t=n.previousSibling,t&&"LI"==t.nodeName&&(r=g.create(n.parentNode.nodeName),t.appendChild(r),r.appendChild(n)),e=!0),void 0))}),r(n),e}function v(){function e(e){g.isEmpty(e)&&g.remove(e)}var n,d=t(y.getRng(!0));return tinymce.each(s(),function(t){var r,d=t.parentNode,s=d.parentNode;if(o(t)&&a(t))if("LI"==s.nodeName)g.insertAfter(t,s),e(s);else{if(!i(s))return;g.remove(d,!0)}else if(o(t))if("LI"==s.nodeName)g.insertAfter(t,s),r=g.create("LI"),r.appendChild(d),g.insertAfter(r,t),e(s);else{if(!i(s))return;s.insertBefore(t,d)}else if(a(t))if("LI"==s.nodeName)g.insertAfter(t,s);else{if(!i(s))return;g.insertAfter(t,d)}else{if("LI"==s.nodeName)d=s,r=f(t,"LI");else{if(!i(s))return;r=f(t,"LI")}l(d,t,r),m(d.parentNode)}n=!0}),r(d),n}function N(n){function o(){function n(n){var t,r,i=e.getBody();for(t=a[n?"startContainer":"endContainer"],r=a[n?"startOffset":"endOffset"],1==t.nodeType&&(t=t.childNodes[Math.min(r,t.childNodes.length-1)]||t);t.parentNode!=i;){if(d(t))return t;if(/^(TD|TH)$/.test(t.parentNode.nodeName))return t;t=t.parentNode}return t}function t(e,n){var t,r=[];if(!d(e)){for(;e&&(t=e[n?"previousSibling":"nextSibling"],!g.isBlock(t)&&t);)e=t;for(;e;)r.push(e),e=e[n?"nextSibling":"previousSibling"]}return r}var r,i,o=n(!0),f=n();i=t(o,!0),o!=f&&(i=i.concat(t(f).reverse())),tinymce.each(i,function(e){if(!g.isBlock(e)||"BR"==e.nodeName){if(!r||"BR"==e.nodeName){if("BR"==e.nodeName&&(!e.nextSibling||g.isBlock(e.nextSibling)&&"BR"!=e.nextSibling.nodeName))return g.remove(e),!1;r=g.create("p"),s.push(r),e.parentNode.insertBefore(r,e)}return"BR"!=e.nodeName?r.appendChild(e):g.remove(e),e==f?!1:void 0}})}var a=y.getRng(!0),f=t(a),s=c();o(),tinymce.each(s,function(e){var t,r;r=e.previousSibling,r&&i(r)&&r.nodeName==n?(t=r,e=g.rename(e,"LI"),r.appendChild(e)):(t=g.create(n),e.parentNode.insertBefore(t,e),t.appendChild(e),e=g.rename(e,"LI")),p(t)}),r(f)}function C(){var e=t(y.getRng(!0));tinymce.each(s(),function(e){var n,t;for(n=e;n;n=n.parentNode)i(n)&&(t=n);l(t,e)}),r(e)}function h(e){var n=g.getParent(y.getStart(),"OL,UL");if(n)if(n.nodeName==e)C(e);else{var i=t(y.getRng(!0));p(g.rename(n,e)),r(i)}else N(e)}var g=e.dom,y=e.selection;n.backspaceDelete=function(e){function n(e,n){var t=e.startContainer,r=e.startOffset;if(3==t.nodeType&&(n?r<t.data.length:r>0))return t;for(var i=new tinymce.dom.TreeWalker(e.startContainer);t=i[n?"next":"prev"]();)if(3==t.nodeType&&t.data.length>0)return t}function o(e,n){var t,r,o=e.parentNode;for(i(n.lastChild)&&(r=n.lastChild),t=n.lastChild,t&&"BR"==t.nodeName&&e.hasChildNodes()&&g.remove(t);t=e.firstChild;)n.appendChild(t);r&&n.appendChild(r),g.remove(e),g.isEmpty(o)&&g.remove(o)}if(y.isCollapsed()){var a=g.getParent(y.getStart(),"LI");if(a){var d=y.getRng(!0),f=g.getParent(n(d,e),"LI");if(f&&f!=a){var s=t(d);return e?o(f,a):o(a,f),r(s),!0}if(!f&&!e&&C(a.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return u()?void 0:!0}),e.addCommand("Outdent",function(){return v()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){h("UL")}),e.addCommand("InsertOrderedList",function(){h("OL")})}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?n.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&n.backspaceDelete(!0)&&e.preventDefault()})});