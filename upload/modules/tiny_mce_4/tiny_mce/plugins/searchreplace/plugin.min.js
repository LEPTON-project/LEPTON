!function(){function e(e,t,n,a,r){function i(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var a=e[t];if(!a)throw"Invalid capture group";n+=e[0].indexOf(a),e[0]=a}return[n,n+e[0].length,[e[0]]]}function o(e){var t;if(3===e.nodeType)return e.data;if(m[e.nodeName])return"";if(t="",(f[e.nodeName]||g[e.nodeName])&&(t+="\n"),e=e.firstChild)do t+=o(e);while(e=e.nextSibling);return t}function d(e,t,n){var a,r,i,o,d=[],s=0,l=e,c=t.shift(),u=0;e:for(;;){if((f[l.nodeName]||g[l.nodeName])&&s++,3===l.nodeType&&(!r&&l.length+s>=c[1]?(r=l,o=c[1]-s):a&&d.push(l),!a&&l.length+s>c[0]&&(a=l,i=c[0]-s),s+=l.length),a&&r){if(l=n({startNode:a,startNodeIndex:i,endNode:r,endNodeIndex:o,innerNodes:d,match:c[2],matchIndex:u}),s-=r.length-o,a=null,r=null,d=[],c=t.shift(),u++,!c)break}else{if(!m[l.nodeName]&&l.firstChild){l=l.firstChild;continue}if(l.nextSibling){l=l.nextSibling;continue}}for(;;){if(l.nextSibling){l=l.nextSibling;break}if(l.parentNode===e)break e;l=l.parentNode}}}function s(e){var t;if("function"!=typeof e){var n=e.nodeType?e:u.createElement(e);t=function(e,t){var a=n.cloneNode(!1);return a.setAttribute("data-mce-index",t),e&&a.appendChild(u.createTextNode(e)),a}}else t=e;return function(e){var n,a,r,i=e.startNode,o=e.endNode,d=e.matchIndex;if(i===o){var s=i;r=s.parentNode,e.startNodeIndex>0&&(n=u.createTextNode(s.data.substring(0,e.startNodeIndex)),r.insertBefore(n,s));var l=t(e.match[0],d);return r.insertBefore(l,s),e.endNodeIndex<s.length&&(a=u.createTextNode(s.data.substring(e.endNodeIndex)),r.insertBefore(a,s)),s.parentNode.removeChild(s),l}n=u.createTextNode(i.data.substring(0,e.startNodeIndex)),a=u.createTextNode(o.data.substring(e.endNodeIndex));for(var c=t(i.data.substring(e.startNodeIndex),d),f=[],m=0,g=e.innerNodes.length;g>m;++m){var h=e.innerNodes[m],v=t(h.data,d);h.parentNode.replaceChild(v,h),f.push(v)}var p=t(o.data.substring(0,e.endNodeIndex),d);return r=i.parentNode,r.insertBefore(n,i),r.insertBefore(c,i),r.removeChild(i),r=o.parentNode,r.insertBefore(p,o),r.insertBefore(a,o),r.removeChild(o),p}}var l,c,u,f,m,g,h=[],v=0;if(u=t.ownerDocument,f=r.getBlockElements(),m=r.getWhiteSpaceElements(),g=r.getShortEndedElements(),c=o(t)){if(e.global)for(;l=e.exec(c);)h.push(i(l,a));else l=c.match(e),h.push(i(l,a));return h.length&&(v=h.length,d(t,h,s(n))),v}}function t(t){function n(){var e=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){t.focus(),o=!1,d.unmarkAllMatches()},buttons:[{text:"Find",onclick:function(){e.find("form")[0].submit()}},{text:"Replace",disabled:!0,onclick:function(){d.replace(e.find("#replace").value())||e.statusbar.items().slice(1).disabled(!0)}},{text:"Replace all",disabled:!0,onclick:function(){d.replaceAll(e.find("#replace").value()),e.statusbar.items().slice(1).disabled(!0)}},{type:"spacer",flex:1},{text:"Prev",disabled:!0,onclick:function(){d.prev()}},{text:"Next",disabled:!0,onclick:function(){d.next()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,onsubmit:function(t){var n,a,r,i,o;return t.preventDefault(),r=e.find("#case").checked(),o=e.find("#words").checked(),i=e.find("#find").value(),i.length?(i=i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=o?"\\b"+i+"\\b":i,a=new RegExp(i,r?"g":"gi"),n=d.markAllMatches(a),n?d.first():tinymce.ui.MessageBox.alert("Could not find the specified string."),e.statusbar.items().slice(1).disabled(0===n),void 0):(d.unmarkAllMatches(),e.statusbar.items().slice(1).disabled(!0),void 0)},items:[{type:"textbox",name:"find",size:40,label:"Find",value:t.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow();o=!0}function a(e){var t=e.parentNode;t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function r(e,n){function a(){var a,o;for(a=n?t.getBody()[e?"firstChild":"lastChild"]:d[e?"endContainer":"startContainer"],o=new tinymce.dom.TreeWalker(a,t.getBody());a=o.current();){if(1==a.nodeType&&"SPAN"==a.nodeName&&null!==a.getAttribute("data-mce-index"))for(s=a.getAttribute("data-mce-index"),r=a.firstChild;a=o.current();){if(1==a.nodeType&&"SPAN"==a.nodeName&&null!==a.getAttribute("data-mce-index")){if(a.getAttribute("data-mce-index")!==s)return;i=a.firstChild}o[e?"next":"prev"]()}o[e?"next":"prev"]()}}var r,i,o=t.selection,d=o.getRng(!0),s=-1;return e=e!==!1,a(),r&&i&&(t.focus(),e?(d.setStart(r,0),d.setEnd(i,i.length)):(d.setStart(i,0),d.setEnd(r,r.length)),o.scrollIntoView(r.parentNode),o.setRng(d)),s}function i(e){e.parentNode.removeChild(e)}var o,d=this,s=-1;d.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Ctrl+F",onclick:n,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Ctrl+F",onclick:n}),e.shortcuts.add("Ctrl+F","",n)},d.markAllMatches=function(n){var a,r;return r=t.dom.create("span",{"class":"mce-match-marker","data-mce-bogus":1}),a=t.getBody(),d.unmarkAllMatches(a),e(n,a,r,!1,t.schema)},d.first=function(){return s=r(!0,!0),-1!==s},d.next=function(){return s=r(!0),-1!==s},d.prev=function(){return s=r(!1),-1!==s},d.replace=function(e,n,o){var d,l,c,u,f,m;if(-1===s&&(s=r(n)),m=r(n),c=t.getBody(),l=tinymce.toArray(c.getElementsByTagName("span")),l.length)for(d=0;d<l.length;d++){var g=l[d].getAttribute("data-mce-index");if(null!==g&&g.length&&(u=f=l[d].getAttribute("data-mce-index"),o||u===s))for(e.length?(l[d].firstChild.nodeValue=e,a(l[d])):i(l[d]);l[++d];)if(u=l[d].getAttribute("data-mce-index"),null!==g&&g.length){if(u!==f){d--;break}i(l[d])}}return-1==m&&(m=r(n,!0)),s=m,o&&t.selection.setCursorLocation(t.getBody(),0),t.undoManager.add(),-1!==s},d.replaceAll=function(e){d.replace(e,!0,!0)},d.unmarkAllMatches=function(){var e,n,r;for(r=t.getBody(),n=r.getElementsByTagName("span"),e=n.length;e--;)r=n[e],r.getAttribute("data-mce-index")&&a(r)},t.on("beforeaddundo keydown",function(e){return o?(e.preventDefault(),!1):void 0})}tinymce.PluginManager.add("searchreplace",t)}();